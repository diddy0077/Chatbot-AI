<!DOCTYPE html>
<html>

<head>
  <title>Chatbot</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    @layer utilities {
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE & Edge */
    scrollbar-width: none;     /* Firefox */
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none; /* Chrome, Safari */
  }
}
  </style>
</head>

<body>
  <div class="js-container flex items-center justify-center"></div>

  <script src="https://unpkg.com/supersimpledev/react.js"></script>
  <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
  <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
  <script src="https://unpkg.com/supersimpledev/babel.js"></script>
  <script type="text/babel">
    function ChatInput({ chatMessages, setChatMessages}) {
      const [input, setInput] = React.useState('')
     function sendMessage() {
         setChatMessages((prev) => {
           return [...prev,
            {
              message: input,
              sender: 'user'
            }
           ]
         })

         const response = Chatbot.getResponse(input)
           setChatMessages((prev) => {
           return [...prev,
            {
              message: <img width='30' src="loading-spinner.gif" alt="loading"/>,
              sender: 'robot'
            }
           ]
         })

           setTimeout(() => {
            setChatMessages((prev) => {
              const updatedMessages = [...prev]
              updatedMessages[updatedMessages.length - 1] = 
                {
                  message: response,
                  sender: 'robot'
                }
              return updatedMessages;
            })
         }, 1000)
       
        setInput('')
     }

      return (
        <div className='my-[2rem] flex w-full'>
          <input onChange={(e) => setInput(e.target.value)} className="border border-gray-400 flex-1 p-2 rounded-lg outline-none focus:ring-2 focus:ring-green-700 transition duration-300 flex-grow min-w-[500px]" placeholder='Send a message to Chatbot' value={input}/>
          <button onClick={sendMessage} className="bg-green-700 text-white p-2 px-4 rounded-lg ml-[1rem] cursor-pointer">Send</button>
        </div>
      );
    }

    function ChatMessage({ sender, message }) {

      return (
        <div className={`flex items-end w-[600px] ${sender === 'robot' ? 'justify-start' : 'justify-end'}`}>
          {sender === 'robot' && <img src="robot.png" alt="user" className="w-[45px]" />}
          <p className="max-w-[400px] bg-gray-100 p-3 rounded-lg mx-2">{message}</p>
          {sender === 'user' && <img src="user.png" alt="user" className="w-[45px]" />}
        </div>
      )

    }

    function ChatMessages({chatMessages}) {
      const div = React.useRef(null)
      React.useEffect(() => {
         div.current.scrollTop = div.current.scrollHeight
      }, [chatMessages])
       
        const chatEl = chatMessages.map((chat, index) => {
         return <ChatMessage
         key={index}
         message={chat.message}
         sender={chat.sender}
         />
       })

       return (
        <div ref={div} className='flex-grow overflow-y-scroll scrollbar-hide'>
          {chatEl}
        </div>
       )
    }

    function App() {
        const [display, setDisplay] = React.useState(false)
       const [chatMessages, setChatMessages] = React.useState([
       ])

       function switchTextInput() {
        setDisplay((prev) => {
         return !prev
        })
       }
   
       return (
          <div className="flex flex-col items-center justify-start container mx-auto h-screen p-6">
            {!display && <ChatInput 
             chatMessages={chatMessages}
             setChatMessages={setChatMessages}
            />}
            {chatMessages.length === 0 && <p className='text-slate-500'>Welcome to the chatbot project! Send a message using the textbox below.</p>}
           <ChatMessages 
           chatMessages={chatMessages}
             setChatMessages={setChatMessages} 
           />
           {display && <ChatInput className='justify-end'
             chatMessages={chatMessages}
             setChatMessages={setChatMessages}
            />}
           <p onClick={switchTextInput} className='underline cursor-pointer'>{!display ? 'Move textbox to bottom' : 'Move textbox to top'}</p>
          </div>
    )
    } 

    const container = document.querySelector('.js-container');
    ReactDOM.createRoot(container).render(<App/>);
  </script>
</body>

</html>